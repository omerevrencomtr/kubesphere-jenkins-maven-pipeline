pipeline {
    agent {
        node {
            label 'maven'
        }

    }
    parameters {
        string(name:'BRANCH_NAME',defaultValue: 'main',description:'')
    }
    environment {
        DOCKER_CREDENTIAL_ID = 'nexus-admin'
        PROD_KUBECONFIG_CREDENTIAL_ID = 'kubeconfig'
        TEST_KUBECONFIG_CREDENTIAL_ID = 'kubeconfig'
        DEV_KUBECONFIG_CREDENTIAL_ID = 'kubeconfig'

        REGISTRY = 'https://docker-registry.miateknoloji.io'
        DOCKERHUB_NAMESPACE = 'omerevrencomtr'
        APP_NAME = 'devops-maven-sample'
        SONAR_CREDENTIAL_ID = 'sonar-token'
        TAG_NAME = "SNAPSHOT-$BRANCH_NAME-$BUILD_NUMBER"
        IMAGE_NAME = 'omerevrencomtr/lamots'
        BUILD_ARGS = "-f Dockerfile-online . --network host"
        DOCKER_REGISTRY = 'https://docker-registry.miateknoloji.io'
        REGISTRY_CREDENTIAL = 'nexus-admin'
    }
    stages {
        stage('build & push') {
            steps {
                script {
                    container('maven') {
                        docker.withRegistry(DOCKER_REGISTRY, REGISTRY_CREDENTIAL) {
                            dockerImage = docker.build(IMAGE_NAME, BUILD_ARGS)
                        }

                    }
                }
            }
        }


    }
}